# 変更履歴

このプロジェクトのすべての顕著な変更は、このファイルに記録されます。

フォーマットは [Keep a Changelog](https://keepachangelog.com/ja/1.1.0/) に基づいており、
このプロジェクトは [セマンティック バージョニング](https://semver.org/spec/v2.0.0.html) に準拠しています。

## [0.1.3] - 2026-02-20

### 追加
- **復旧用CLIツール (`vlt_admin_cli`)**: APIサーバーを介さず、データベースの直接管理やユーザー復旧を可能にするスタンドアロンツール。
- **SBPプロトコル仕様書 (`SBP_SPEC.md`)**: Windowsの「クォート地獄」を解決し、AIエージェントによる自動化を強化する Structured Binary Protocol (SBP) を策定。
- **セキュリティ現状レポート (`SECURITY_STATUS_REPORT.md`)**: 現在のセキュリティ実装、リスク、および既知の脆弱性を透明性をもって公開。
- **管理システム再設計プラン**: ローカルファーストで復旧を重視した管理モデルへのアーキテクチャ移行を文書化。

### 変更
- ロードマップを洗練し、「スタンドアロンとしての完全性」を優先。複雑なMFA（多要素認証）への依存を排除。
- TPM操作に伴う安全性への警告と、リモートでのBitLockerリカバリー画面ロックアウトのリスクを追記。
- **セキュリティ強化**: ブルートフォース攻撃やリソース枯渇を防ぐため、認証リトライ制限 (`SEC-01`) とセッションアイドルタイムアウトを実装。
- **IPC安全性**: サービス・ワーカー間の通信におけるバッファ問題を防止するため、IPCメッセージの長さフレーミング (`ALGO-01`) を修正。
- **PowerShellサニタイズ**: シェルインジェクションを防止するため、コマンド引数のサニタイズ処理 (`SEC-04`) を改善。
- **プロセス管理**: 信頼性とパフォーマンス向上のため、`wmic` 呼び出しを `tasklist` およびネイティブAPIクエリ (`ALGO-03`) に置き換え。

### セキュリティ
- 現在修正中の約10件の既知の脆弱性について、誠実な情報開示を実施。
- 複雑なMFAの現実的な代替案として、SSH鍵のパスフレーズ使用を推奨。
- すべての `unsafe` ブロックの安全性レビューを実施し、`UserToken` のスレッド安全性を確認。

## [浄化された復元] - 2026-02-19

### 追加
- **レジリエンス層**: サービス再起動後もセッションを追跡できるよう、DBの `sessions` テーブルに `worker_pid` と `pipe_name` を追加。
- **自動化スクリプト**: ワンクリックでセットアップを完了させる `Install-WinNativeSSH.ps1`、`Enable-WSL.ps1`、`Setup-DefenderDebugExclusions.ps1` を導入。
- **Nushell統合**: モダンなシェルの導入を容易にする `Get-Nushell.ps1` を追加。

### 修正
- **IPC標準化**: Enumバリアントの明示的なタグ付けにより、Serdeのデシリアライズ問題を修正。
- **コアの安定化**: レガシーな `m4_fast` などの不純物を排除し、ワーカーのメインループをシンプル化。
- **パスの一貫性**: データベースのパスを実行ファイルからの絶対パスに統一。

## [v0.6.0-Draft] - 2026-02-18

### 追加
- **SBPの進化**: AIエージェント向けに、バージョン管理された `upgrade-sbp` ハンドシェイクと `sbp-spec` 自己文書化コマンドを導入。
- **配布戦略**: プロトコルの純粋性を保つため、独自コマンドによるバイナリ転送を廃止し、標準の **SCP** 推奨へ移行。

## [v0.5.0] - 2026-02-16

### 変更
- **russh 0.40 移行**: `russh` 0.40 API（PublicKeyパスやBase64トレイトの変更）に完全対応。
- **ACL診断**: `vlt-admin check-permissions` が正しく動作するよう `WindowsUserInfo` の扱いを修正。

## [v0.4.0] - 2026-02-16

### 追加
- **CI/CD基盤**: WindowsおよびLinuxでの自動ビルド・テストを行う GitHub Actions を導入。
- **vlt-worker機能強化**: 内部コマンド `env` の追加と、メモリ/セッション情報を表示する `tasklist` の改善。

## [v0.3.0] - 2026-02-15

### 追加
- **コマンドインターセプト**: 外部プロセス依存を排除するため、`vlt-worker` 内に `whoami`、`where`、`tasklist` を実装。
- **サービス安定性**: ワーカーの即時クリーンアップのため、SSHチャネルの EOF/Close ハンドラを実装。
